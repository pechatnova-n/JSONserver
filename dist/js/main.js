(()=>{"use strict";const e=e=>{const t=document.getElementById("table-body");t.innerHTML="",e.forEach((e=>{t.insertAdjacentHTML("beforeend",`\n            <tr data-key=${e.id}>\n               <th scope="row">${e.id}</th>\n               <td>${e.name}</td>\n               <td>${e.email}</td>\n               <td>${e.children?"Есть":"Нет"}</td>\n               <td>\n                    <div class="form-check form-switch">\n                                        <input class="form-check-input" type="checkbox" role="switch"\n                                            id="form-children" ${e.permissions?"checked":""}>\n                                    </div>\n               </td>\n               <td>\n                   <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">\n                                        <button type="button" class="btn btn-warning btn-edit">\n                                            <i class="bi-pencil-square"></i>\n                                        </button>\n                                        <button type="button" class="btn btn-danger btn-remove">\n                                            <i class="bi-person-x"></i>\n                                        </button>\n                                    </div>\n               </td>\n            </tr>\n         `)}))};window.userService=new class{getData(e){return fetch(e).then((e=>e.json())).catch((e=>{console.log(e);const t=document.querySelector(".table-responsive"),r=document.createElement("p");t.append(r),r.textContent="Произошла ошибка, данных нет!"}))}sendData(e,t){return fetch(e,t).then((e=>e.json())).catch((e=>{console.log(e);const t=document.querySelector(".table-responsive"),r=document.createElement("p");t.append(r),r.textContent="Произошла ошибка, данных нет!"}))}getUsers(){return userService.getData("http://localhost:4545/users").then((e=>e))}getUser(e){return userService.getData(`http://localhost:4545/users/${e}`).then((e=>e))}filterUsers(e){return userService.getData(`http://localhost:4545/users?${e}=true`).then((e=>e))}getSortUsers(e){return userService.getData(`http://localhost:4545/users?_sort=${e.name}&_order=${e.value}`).then((e=>e))}getSearchUsers(e){return userService.getData(`http://localhost:4545/users?name_like=${e}`).then((e=>e))}addUser(e){return userService.sendData("http://localhost:4545/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e))}removeUser(e){return userService.sendData(`http://localhost:4545/users/${e}`,{method:"DELETE"}).then((e=>e))}changeUser(e,t){return userService.sendData(`http://localhost:4545/users/${e}`,{method:"PATCH",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e))}editUser(e,t){return userService.sendData(`http://localhost:4545/users/${e}`,{method:"PUT",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e))}},userService.getUsers().then((t=>{e(t)})),(()=>{const t=document.querySelector("form"),r=t.querySelector("#form-name"),n=t.querySelector("#form-email"),s=t.querySelector("#form-children");t.addEventListener("submit",(c=>{if(c.preventDefault(),!t.dataset.method){const c={name:r.value,email:n.value,children:s.checked,permissions:!1};userService.addUser(c).then((()=>{userService.getUsers().then((r=>{e(r),t.reset()}))}))}}))})(),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest(".btn-remove")){const r=t.target.closest("tr").dataset.key;userService.removeUser(r).then((t=>{userService.getUsers().then((t=>{e(t)}))}))}})),document.getElementById("table-body").addEventListener("click",(t=>{if(t.target.closest("input[type=checkbox]")){const r=t.target.closest("tr"),n=r.querySelector("input[type=checkbox]"),s=r.dataset.key;userService.changeUser(s,{permissions:n.checked}).then((t=>{userService.getUsers().then((t=>{e(t)}))}))}})),(()=>{const t=document.querySelector("form"),r=t.querySelector("#form-name"),n=t.querySelector("#form-email"),s=t.querySelector("#form-children");document.getElementById("table-body").addEventListener("click",(e=>{if(e.target.closest(".btn-edit")){const c=e.target.closest("tr").dataset.key;userService.getUser(c).then((e=>{r.value=e.name,n.value=e.email,s.checked=e.children,t.dataset.method=c}))}})),t.addEventListener("submit",(c=>{if(c.preventDefault(),t.dataset.method){const c=t.dataset.method,o={name:r.value,email:n.value,children:s.checked,permissions:!1};userService.editUser(c,o).then((()=>{userService.getUsers().then((r=>{e(r),t.reset(),t.removeAttribute("data-method")}))}))}}))})(),(()=>{const t=document.getElementById("btn-isChildren"),r=document.getElementById("btn-isPermissions"),n=document.getElementById("btn-isAll");t.addEventListener("click",(()=>{userService.filterUsers("children").then((t=>{e(t)}))})),r.addEventListener("click",(()=>{userService.filterUsers("permissions").then((t=>{e(t)}))})),n.addEventListener("click",(()=>{userService.getUsers("permissions").then((t=>{e(t)}))}))})(),(()=>{const t=document.getElementById("sort-is-children");let r=!1;t.style.cursor="pointer",t.addEventListener("click",(()=>{userService.getSortUsers({name:"children",value:r?"asc":"desc"}).then((t=>{e(t)})),r=!r}))})(),(()=>{const t=document.getElementById("search-input"),r=((e,t=300)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout((()=>{e.apply(void 0,n)}),t)}})((()=>{userService.getSearchUsers(t.value).then((t=>{e(t)}))}),500);t.addEventListener("input",r)})()})();